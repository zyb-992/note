# SSL安全层

## 加密方法

### 	对称密钥加密

1. 指通信双方使用相同的密钥进行加解密，这里的密钥为公钥

### 	公开密钥加密

1. 指通信双方拥有各自的公钥和私钥，客户端使用服务端的公钥加密数据，服务端使用自己的私钥解密，服务端使用客户端的公钥加密数据，客户端使用自己的私钥解密

## 使用RSA算法生成密钥对

1. 选择两个大素数p和q
2. 计算`n=p*q`以及`z=(p-1)*(q-1)`
3. 选择小于n的整数e，且e和z没有公因数（除1外
4. 选择一个数d，使得`e*d-1`被z整除
5. 生成的公钥是`(n,e)`，私钥是`(n,d)`

## 报文完整性和数字签名

### 	密码散列函数

1. 散列函数以用户数据m作为输入，并计算得到一个称为**报文摘要**的固定长度的字符串H(m)
2. 不可能找得到两个不同的报文x和y，使得H(x)=H(y)，**即一个报文对应一个报文摘要**
3. 散列函数生成的散列字符串被用来确认m是否在传输途中被篡改
4. 一般使用MD5散列算法，或者SHA-1
5. **比较过程**（使用数字签名
   - 服务端将消息m进行Hash 得到报文摘要H(m)
   - 生成(m, H(m))报文 并发送给客户端
   - 客户端得到该报文 通过相同的散列算法 对m进行Hash 生成H(m)'
   - 判断H(m)'与H(m)是否相等，若不相等则证明消息m在中途被篡改

### 	报文鉴别码

1. 使用散列函数也存在安全性隐患，例如某用户也可以生成对应的(m',H(m)')来伪造自己是(m.H(m))的迹象
2. 因此除了使用密码散列函数以外，还需要使用到一个**鉴别密钥**，它是一个只有在服务端和客户端之间的共享密码
3. 这样保证了在对散列后的消息进行比较时，能确定对方是否是我们想要真实通信的那个人
4. **使用报文鉴别码的比较过程**
   - 服务端将消息m与鉴别密钥s进行Hash 得到H(m+s) **H(m+s)被称为报文鉴别码**
   - 生成(m, H(m+s))报文 并发送给客户端
   - 客户端得到该报文 因为客户端同样拥有与服务端相同的鉴别密钥s 通过相同的散列算法 对(m+s)进行Hash 生成H(m+s)'
   - 判断H(m+s)'与H(m+s)是否相等，若不相等则证明消息m在中途被篡改

### 	数字签名

> 使用私钥加密的报文 也能通过公钥解密

1. 数字签名主要是为了证明数据方的真实性
2. 数字签名满足了可鉴别、不可伪造的需求
3. 主要是通过**私钥**对报文进行加密，对方再使用公钥对加密了的报文进行解密，因为私钥是唯一的，加密后的报文若被篡改，则不能通过公钥进行解密，所以保证了报文的唯一性和完整性
4. 但是对报文加密/解密的代价太大，我们可以通过对报文通过散列函数进行Hash，从而得到固定长度的H(m)，再对这个H(m)使用私钥进行加密，代价会少很多
5. **应用**
   1. **公钥认证**
      - 证实一个公钥属于某个特定的实体
      - 通过认证中心CA进行公钥与特定实体的绑定，CA证实一个实体的真实身份，若该实体没有在CA注册过，CA没有其真实信息的话，那么会认为该实体是不安全的
      - 一旦CA验证了 某个实体的身份，CA会生成一个将其身份与实体的公钥绑定起来的**证书**，这个证书包含了公钥与公钥所有者全局唯一的身份标识信息，由CA来对这份证书进行**数字签名**

## 数字证书

1. 一个实体证书的拥有者和他公钥的捆绑关系，证书放发者使用自身的私钥对该关系进行了一个签署
2. 使用证书发放者的公钥来对该关系进行一个验证，查看该实体以及该公钥的真实性

## 使TCP连接更为安全:SSL 

1. SSL：安全套接字层；是TCP的强化版本，提供数据的机密性，数据完整性和端点鉴别，使用了安全性服务加强了TCP
2. **TLS**是SSL版本3的一个稍加修改的版本，被称为运输层安全性
3. [3.3 HTTPS RSA 握手解析 | 小林coding (xiaolincoding.com)](https://www.xiaolincoding.com/network/2_http/https_rsa.html)

## 使用openssl工具生成密钥对以及相关证书

1. 使用`openssl genrsa -out rsa_private.key 2048`生成无加密的RSA私钥
2. 通过该私钥生成公钥 `openssl rsa -in rsa_private.key -pubout -out rsa_public.key`
3. 生成RSA私钥（使用aes256加密 `openssl genrsa -aes256 -passout pass:111111 -out rsa_aes_private.key 2048`
4. 
